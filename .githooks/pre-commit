#!/bin/bash
# .githooks/pre-commit

echo "üõ°Ô∏è  Verity Pre-Commit Hook: Running Quality & Security Gates..."

# On s'assure d'√™tre √† la racine du projet
cd "$(git rev-parse --show-toplevel)"

# 1. On lance ton script anti-panique / s√©curit√©
echo "--- Running deny_unsecure.sh ---"
./.githooks/deny_unsecure.sh
if [ $? -ne 0 ]; then
  echo "‚ùå Security Check Failed! Commit aborted."
  exit 1
fi

# 2. On lance ta v√©rification globale (lints, tests, formats)
echo "--- Running full_verify.sh ---"
./.githooks/full_verify.sh
if [ $? -ne 0 ]; then
  echo "‚ùå Quality Check Failed! Fix the errors and try committing again."
  exit 1
fi

echo "‚úÖ All gates passed. Committing..."
exit 0